<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>ng-xterm documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">ng-xterm documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>NodePtyService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/terminal/services/node-pty.service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Provide node-pty as a service </p>

            </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#pty">pty</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#ptyProcess">ptyProcess</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#createFactoryObject">createFactoryObject</a>
                            </li>
                            <li>
                                <a href="#createFactoryObjectError">createFactoryObjectError</a>
                            </li>
                            <li>
                                <a href="#destroyFactoryObject">destroyFactoryObject</a>
                            </li>
                            <li>
                                <a href="#destroyFactoryObjectError">destroyFactoryObjectError</a>
                            </li>
                            <li>
                                <a href="#handleDragAndDrop">handleDragAndDrop</a>
                            </li>
                            <li>
                                <a href="#initialize">initialize</a>
                            </li>
                            <li>
                                <a href="#ngOnDestroy">ngOnDestroy</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(settingsService: <a href="../injectables/SettingsService.html">SettingsService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="17" class="link-to-prism">src/terminal/services/node-pty.service.ts:17</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>settingsService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/SettingsService.html" target="_self" >SettingsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createFactoryObject"></a>
                    <span class="name">
                        <b>
                            createFactoryObject
                        </b>
                        <a href="#createFactoryObject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>createFactoryObject()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="36"
                            class="link-to-prism">src/terminal/services/node-pty.service.ts:36</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Configure the pty service instance.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>IPty</code>

                    </div>
                    <div class="io-description">
                        <p>IPty an instance of the node-pty module.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createFactoryObjectError"></a>
                    <span class="name">
                        <b>
                            createFactoryObjectError
                        </b>
                        <a href="#createFactoryObjectError"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>createFactoryObjectError()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="27"
                            class="link-to-prism">src/terminal/services/node-pty.service.ts:27</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>An error describing why the pty process could not be created.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Error</code>

                    </div>
                    <div class="io-description">
                        <p>an error providing possible reasons the node-pty process could not be created.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="destroyFactoryObject"></a>
                    <span class="name">
                        <b>
                            destroyFactoryObject
                        </b>
                        <a href="#destroyFactoryObject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>destroyFactoryObject()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="74"
                            class="link-to-prism">src/terminal/services/node-pty.service.ts:74</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Kill the pty process once the component it is injected into
is removed from the DOM via ngOnDestroy.</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="destroyFactoryObjectError"></a>
                    <span class="name">
                        <b>
                            destroyFactoryObjectError
                        </b>
                        <a href="#destroyFactoryObjectError"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>destroyFactoryObjectError()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="87"
                            class="link-to-prism">src/terminal/services/node-pty.service.ts:87</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Error</code>

                    </div>
                    <div class="io-description">
                        <p>An error describing possible reasons the pty process could not be killed.</p>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="handleDragAndDrop"></a>
                    <span class="name">
                        <b>
                            handleDragAndDrop
                        </b>
                        <a href="#handleDragAndDrop"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>handleDragAndDrop()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="105"
                            class="link-to-prism">src/terminal/services/node-pty.service.ts:105</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>When a file or files are dropped on the terminal,
we loop through the file(s) which were dropped, and use the
underlying pty to write their values. By using the pty
instead of the terminal, we can then perform standard
terminal actions on the file, such as &quot;cat&quot;, &quot;ls&quot;, etc.</p>
<p>If the terminal is used rather than the pty, when the user
hits enter, no commands can be applied to the file path
as the terminal relies on the underlying pty for command
execution.</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="initialize"></a>
                    <span class="name">
                        <b>
                            initialize
                        </b>
                        <a href="#initialize"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>initialize(terminal: Terminal)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="144"
                            class="link-to-prism">src/terminal/services/node-pty.service.ts:144</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Configure and initialize communication and resize events between the pty session,
and the underlying terminal</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>terminal</td>
                                    <td>
                                            <code>Terminal</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>the terminal to be associated with the pty service instance.</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="ngOnDestroy"></a>
                    <span class="name">
                        <b>
                            ngOnDestroy
                        </b>
                        <a href="#ngOnDestroy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>ngOnDestroy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="159"
                            class="link-to-prism">src/terminal/services/node-pty.service.ts:159</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Destroy the pty service instance when the component this service is provided to is unmounted/destroyed. </p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="pty"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                                <span class="modifier">Readonly</span>
                            pty</b>
                            <a href="#pty"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="14" class="link-to-prism">src/terminal/services/node-pty.service.ts:14</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>A type context to refer to the type of a pty from the node-pty module   </p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="ptyProcess"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Private</span>
                            ptyProcess</b>
                            <a href="#ptyProcess"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>IPty</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="17" class="link-to-prism">src/terminal/services/node-pty.service.ts:17</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                        <div class="io-description"><p>An interface representing a pseudoterminal, on Windows this is emulated via the winpty library. </p>
</div>
                    </td>
                </tr>

            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, OnDestroy } from &quot;@angular/core&quot;
import { IPty } from &quot;node-pty&quot;
import * as pty from &quot;node-pty&quot;
import { SettingsService } from &quot;@shared/services&quot;
import { Settings } from &quot;@shared/utils&quot;
import { Terminal } from &quot;xterm&quot;

/** Provide node-pty as a service */
@Injectable({ providedIn: &quot;root&quot; })

export class NodePtyService implements OnDestroy {

	/** A type context to refer to the type of a pty from the node-pty module   */
	private readonly pty: typeof pty

	/** An interface representing a pseudoterminal, on Windows this is emulated via the winpty library. */
	private ptyProcess: IPty

	constructor(private readonly settingsService: SettingsService) {
		this.pty &#x3D; window.require(&quot;node-pty&quot;)
	}

	/**
	 * An error describing why the pty process could not be created.
	 * @returns an error providing possible reasons the node-pty process could not be created.
	 * */
	createFactoryObjectError(): Error {
		throw new Error(&quot;The node-pty process could not be created. This usually means one of two things, the pty instance or one of &quot; +
			&quot;its values was undefined, or node-pty needs to be rebuild. To do rebuild, please run the rebuild:pty script in package.json&quot;)
	}

	/**
	 * Configure the pty service instance.
	 * @returns IPty an instance of the node-pty module.
	 * */
	createFactoryObject(): IPty {
		try {
			//const isWindows &#x3D; operatingSystems.IS_WINDOWS ? &quot;powershell.exe&quot; : this.settingsService.getItem(AppSettings.TERM_SHELL_TYPE) as string
			this.ptyProcess &#x3D; this.pty.spawn(this.settingsService.getItem(Settings.SHELL_TYPE) as string, [&quot;--login&quot;], {

				// get the type of terminal session from the settings store.
				name: this.settingsService.getItem(Settings.TERM_TYPE) as string,

				// set the working directory for the pty process
				cwd: process.env.HOME,

				// get the number of rows the pty should be from the settings store.
				rows: +this.settingsService.getItem(Settings.PTY_ROWS),

				// get the number of columns the pty should be from the settings store.
				cols: +this.settingsService.getItem(Settings.PTY_COLS),

				env: process.env,

				// allow the pty to handle control flow
				handleFlowControl: true,

				// use the conpty back end if we are running on Windows.
				useConpty: process.platform &#x3D;&#x3D;&#x3D; &quot;win32&quot;
			})
			// display the process id of the current pty process
			console.log(&quot;Creating pty process&quot;, this.ptyProcess?.pid)
			return this.ptyProcess
		} catch {
			// return an error telling the user what happened
			this.createFactoryObjectError()
		}
	}

	/**
	 * Kill the pty process once the component it is injected into
	 * is removed from the DOM via ngOnDestroy.
	 * */
	destroyFactoryObject() {
		try {
			this.ptyProcess.kill()
			console.log(&quot;Destroying pty process&quot;, this.ptyProcess?.pid)
		} catch {
			this.destroyFactoryObjectError()
			return
		}
	}

	/**
	 * @returns {Error} An error describing possible reasons the pty process could not be killed.
	 * */
	destroyFactoryObjectError(): Error {
		throw new Error(&quot;The node-pty instance could not be destroyed. This usually means the underlying pty instance or one of its values was undefined&quot;)
	}

	/**
	 * When a file or files are dropped on the terminal,
	 * we loop through the file(s) which were dropped, and use the
	 * underlying pty to write their values. By using the pty
	 * instead of the terminal, we can then perform standard
	 * terminal actions on the file, such as &quot;cat&quot;, &quot;ls&quot;, etc.
	 *
	 * If the terminal is used rather than the pty, when the user
	 * hits enter, no commands can be applied to the file path
	 * as the terminal relies on the underlying pty for command
	 * execution.
	 *
	 *@todo figure out a way to prevent the dropped files from being displayed on ALL terminals.
	 * */
	handleDragAndDrop() {
		// add a listener for the &quot;dragenter&quot; event and prevent the default behavior.
		document.addEventListener(&quot;dragenter&quot;, (e) &#x3D;&gt; {
			e.preventDefault()
			e.stopPropagation()
		})
		// add a listener for the &quot;drop&quot; event and prevent the default behavior.
		document.addEventListener(&quot;drop&quot;, (e) &#x3D;&gt; {
			e.preventDefault()
			e.stopPropagation()

			/* Loop through the file(s) which were dropped onto the terminal,
			 * and use the pty to write their values to the underlying terminal.
			 *
			 * ts-ignore is used because Typescript throws error code
			 * TS2495: Type &#x27;FileList&#x27; is not an array type or a string type.
			 * even though the file names are read and written by pty
			 * without any issues. If anyone knows how to fix this, please feel
			 * free to let me know how.
			 */
			//@ts-ignore
			for(const f of e.dataTransfer.files) {
				this.ptyProcess?.write(f.path)
			}
		})
		// add a listener for the &quot;dragover&quot; event and prevent the default behavior.
		document.addEventListener(&quot;dragover&quot;, (e) &#x3D;&gt; {
			e.preventDefault()
			e.stopPropagation()
		})
	}


	/**
	 * Configure and initialize communication and resize events between the pty session,
	 * and the underlying terminal
	 *
	 * @param {Terminal} terminal the terminal to be associated with the pty service instance.
	 * */
	initialize(terminal: Terminal) {
		// configure pty/terminal communication.
		this.ptyProcess?.onData((chunk) &#x3D;&gt; terminal?.write(&#x60;${ chunk }&#x60;))
		terminal?.onData((data) &#x3D;&gt; this.ptyProcess?.write(&#x60;${ data }&#x60;))

		// handle resize events.
		terminal.onResize((data) &#x3D;&gt; {
			this.ptyProcess?.resize(
				Math.max(data ? data.cols : terminal.cols, 1),
				Math.max(data ? data.rows : terminal.rows, 1)
			)
		})
	}

	/** Destroy the pty service instance when the component this service is provided to is unmounted/destroyed. */
	ngOnDestroy() {
		this.destroyFactoryObject()
	}

}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'NodePtyService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
